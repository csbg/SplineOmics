<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Designing a Limma Design Formula • SplineOmics</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Designing a Limma Design Formula">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SplineOmics</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/CHANGELOG.html">Changelog</a></li>
    <li><a class="dropdown-item" href="../articles/design_limma_design_formula.html">Designing a Limma Design Formula</a></li>
    <li><a class="dropdown-item" href="../articles/Docker_permission_denied.html">Docker_permission_denied</a></li>
    <li><a class="dropdown-item" href="../articles/Docker-instructions.html">Docker-instructions</a></li>
    <li><a class="dropdown-item" href="../articles/get-started.html">get-started</a></li>
    <li><a class="dropdown-item" href="../articles/glycan-analysis.html">Glycan-analysis</a></li>
    <li><a class="dropdown-item" href="../articles/limma_result_categories.html">limma_result_categories</a></li>
    <li><a class="dropdown-item" href="../articles/methylation_data_analysis.html">methylation-data-analysis</a></li>
    <li><a class="dropdown-item" href="../articles/PVC_analysis.html">PVC_analysis</a></li>
    <li><a class="dropdown-item" href="../articles/RNA-seq-analysis.html">RNA-seq-analysis</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../articles/CHANGELOG.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/csbg/SplineOmics/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Designing a Limma Design Formula</h1>
                        <h4 data-toc-skip class="author">Your Name</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/csbg/SplineOmics/blob/HEAD/vignettes/design_limma_design_formula.Rmd" class="external-link"><code>vignettes/design_limma_design_formula.Rmd</code></a></small>
      <div class="d-none name"><code>design_limma_design_formula.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>limma</code> package is a powerful tool for analyzing gene
expression data, particularly in the context of microarrays and RNA-seq.
A critical part of any <code>limma</code> analysis is the design
formula, which specifies the experimental conditions and contrasts that
you are interested in. This vignette provides a guide on how to
construct a <code>limma</code> design formula correctly, with examples
and best practices.</p>
</div>
<div class="section level2">
<h2 id="understanding-the-design-matrix">Understanding the Design Matrix<a class="anchor" aria-label="anchor" href="#understanding-the-design-matrix"></a>
</h2>
<p>The design matrix is a crucial component in any differential
expression analysis using <code>limma</code>. It defines the
relationships between the samples and the experimental conditions
(factors) under investigation. A well-constructed design matrix allows
<code>limma</code> to correctly model the effects of these factors and
estimate the differential expression.</p>
<div class="section level3">
<h3 id="basic-design-formula">Basic Design Formula<a class="anchor" aria-label="anchor" href="#basic-design-formula"></a>
</h3>
<p>In its simplest form, the design formula includes only one factor,
such as treatment vs. control. If your experiment involves comparing two
conditions (e.g., <code>treated</code> vs. <code>untreated</code>), you
can create a design formula like this:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">condition</span>, data <span class="op">=</span> <span class="va">meta</span><span class="op">)</span></span></code></pre></div>
<p>Here, condition is a factor variable in your metadata (meta) that
represents the experimental groups.</p>
<p>Important Points: The ~ 0 + condition syntax tells R to create a
design matrix without an intercept (i.e., a matrix where each level of
the factor condition is represented by its own column). This approach is
helpful when you want to make direct comparisons between conditions.
Including Multiple Factors If your experiment includes more than one
factor, such as time points and treatments, you can include both in the
design formula:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">treatment</span> <span class="op">+</span> <span class="va">time</span>, data <span class="op">=</span> <span class="va">meta</span><span class="op">)</span></span></code></pre></div>
<p>This formula assumes that the effects of treatment and time are
additive (no interaction). If you suspect that the interaction between
treatment and time might be important, you can include an interaction
term:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">treatment</span> <span class="op">*</span> <span class="va">time</span>, data <span class="op">=</span> <span class="va">meta</span><span class="op">)</span></span></code></pre></div>
<p>Interaction Term: The treatment * time term includes both the main
effects of treatment and time and their interaction. Blocking Factors In
some experiments, you might have technical or biological replicates, or
other blocking factors (e.g., batch effects). You can include these
blocking factors in your design formula:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">treatment</span> <span class="op">+</span> <span class="va">batch</span>, data <span class="op">=</span> <span class="va">meta</span><span class="op">)</span></span></code></pre></div>
<p>This formula accounts for both treatment and batch effects, ensuring
that your analysis is not confounded by batch effects.</p>
</div>
</div>
<div class="section level2">
<h2 id="creating-contrasts">Creating Contrasts<a class="anchor" aria-label="anchor" href="#creating-contrasts"></a>
</h2>
<p>After defining your design matrix, you will likely want to make
specific comparisons between conditions. This is where contrasts come
in. For example, to compare treated vs. untreated, you can define a
contrast matrix:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contrast</span> <span class="op">&lt;-</span> <span class="fu">makeContrasts</span><span class="op">(</span></span>
<span>  treated_vs_untreated <span class="op">=</span> <span class="va">treatmenttreated</span> <span class="op">-</span> <span class="va">treatmentuntreated</span>,</span>
<span>  levels <span class="op">=</span> <span class="va">design</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="practical-example">Practical Example<a class="anchor" aria-label="anchor" href="#practical-example"></a>
</h2>
<p>Let’s say you have an experiment with two treatments (A and B) and
two time points (early and late). Your metadata might look like
this:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  sample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S1"</span>, <span class="st">"S2"</span>, <span class="st">"S3"</span>, <span class="st">"S4"</span><span class="op">)</span>,</span>
<span>  treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"B"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"early"</span>, <span class="st">"late"</span>, <span class="st">"early"</span>, <span class="st">"late"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Your design formula would be:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">treatment</span> <span class="op">*</span> <span class="va">time</span>, data <span class="op">=</span> <span class="va">meta</span><span class="op">)</span></span></code></pre></div>
<p>And a contrast to compare treatment A at the early time point against
treatment B at the late time point would be:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contrast</span> <span class="op">&lt;-</span> <span class="fu">makeContrasts</span><span class="op">(</span></span>
<span>  A_early_vs_B_late <span class="op">=</span> <span class="op">(</span><span class="va">treatmentA</span><span class="op">:</span><span class="va">timeearly</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="va">treatmentB</span><span class="op">:</span><span class="va">timelate</span><span class="op">)</span>,</span>
<span>  levels <span class="op">=</span> <span class="va">design</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<ol style="list-style-type: decimal">
<li>
<strong>Intercept or No Intercept:</strong>
<ul>
<li>Starting with <code>~ 0</code> means no intercept (i.e., not
including a baseline group in the model).</li>
<li>Starting with <code>~ 1</code> (or just <code>~</code>) includes an
intercept (baseline group).</li>
</ul>
</li>
<li>
<strong>Additive Factors:</strong>
<ul>
<li>Factors separated by <code>+</code> indicate additive effects. For
example, <code>~ 0 + factor1 + factor2</code> means you are modeling the
effects of <code>factor1</code> and <code>factor2</code> additively,
without considering interactions.</li>
</ul>
</li>
<li>
<strong>Interaction Terms:</strong>
<ul>
<li>The <code>*</code> symbol is used to model interactions between
factors. For example, <code>~ 0 + factor1 * factor2</code> will include
<code>factor1</code>, <code>factor2</code>, and their interaction
(<code>factor1:factor2</code>).</li>
<li>Alternatively, you can specify the interaction explicitly with
<code>:</code>. For example,
<code>~ 0 + factor1 + factor2 + factor1:factor2</code> is equivalent to
<code>~ 0 + factor1 * factor2</code>.</li>
</ul>
</li>
</ol>
<div class="section level3">
<h3 id="some-examples">Some examples:<a class="anchor" aria-label="anchor" href="#some-examples"></a>
</h3>
<ul>
<li>
<code>~ 0 + factor1 + factor2</code>: Additive model without an
intercept.</li>
<li>
<code>~ 1 + factor1 + factor2</code>: Additive model with an
intercept.</li>
<li>
<code>~ 0 + factor1 * factor2</code>: Model with main effects and
their interaction, no intercept.</li>
<li>
<code>~ 1 + factor1 * factor2</code>: Model with intercept, main
effects, and their interaction.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<pre><code><span><span class="co">## R version 4.5.1 (2025-06-13)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">## Running under: Ubuntu 22.04.5 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.10.0 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.10.0  LAPACK version 3.10.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span></span>
<span><span class="co">##  [3] LC_TIME=de_AT.UTF-8        LC_COLLATE=en_US.UTF-8    </span></span>
<span><span class="co">##  [5] LC_MONETARY=de_AT.UTF-8    LC_MESSAGES=en_US.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=de_AT.UTF-8       LC_NAME=C                 </span></span>
<span><span class="co">##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span></span>
<span><span class="co">## [11] LC_MEASUREMENT=de_AT.UTF-8 LC_IDENTIFICATION=C       </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: Europe/Vienna</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices datasets  utils     methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] digest_0.6.37       desc_1.4.3          R6_2.6.1           </span></span>
<span><span class="co">##  [4] fastmap_1.2.0       xfun_0.53           cachem_1.1.0       </span></span>
<span><span class="co">##  [7] knitr_1.50          htmltools_0.5.8.1   rmarkdown_2.29     </span></span>
<span><span class="co">## [10] lifecycle_1.0.4     cli_3.6.5           sass_0.4.10        </span></span>
<span><span class="co">## [13] pkgdown_2.1.3       textshaping_1.0.3   jquerylib_0.1.4    </span></span>
<span><span class="co">## [16] renv_1.1.5          systemfonts_1.2.3   compiler_4.5.1     </span></span>
<span><span class="co">## [19] rstudioapi_0.17.1   tools_4.5.1         ragg_1.4.0         </span></span>
<span><span class="co">## [22] bslib_0.9.0         evaluate_1.0.5      yaml_2.3.10        </span></span>
<span><span class="co">## [25] BiocManager_1.30.26 jsonlite_2.0.0      htmlwidgets_1.6.4  </span></span>
<span><span class="co">## [28] rlang_1.1.6         fs_1.6.6</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Rauter.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
