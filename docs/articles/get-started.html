<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>get-started • SplineOmics</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="get-started">
<meta property="og:description" content="SplineOmics">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SplineOmics</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Docker_permission_denied.html">Docker permission denied</a>
    </li>
    <li>
      <a href="../articles/functions-in-depth.html">functions-in-depth</a>
    </li>
    <li>
      <a href="../articles/get-started.html">get-started</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>get-started</h1>
                        <h4 data-toc-skip class="author">Thomas
Rauter</h4>
            
            <h4 data-toc-skip class="date">10 June, 2024</h4>
      
      
      <div class="hidden name"><code>get-started.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="about-this-tutorial">About this tutorial<a class="anchor" aria-label="anchor" href="#about-this-tutorial"></a>
</h2>
<p>This tutorial intends to showcase and explain the capabilities of the
SplineOmics package by walking through a real and complete example, from
start to the end. The example is a time-series proteomics experiment, in
which CHO cells were cultivated in three bioreactors (three biological
replicates). Both in the exponential and stationary growth phase,
samples were taken from each reactor in triplicates at defined
timepoints relative to a feeding of the cells (60 min before feeding,
and 15, 60, 90, 120, and 240 min after). The goal of this analysis is to
find out which of the 7162 cellular proteins show a significant change
over time after the CHO cells were fed. Further, the hits (proteins with
a significant change over time) are clustered based on their temporal
pattern, and a gene set enrichment analysis is performed with each
cluster to see if there are processes which are up- or downregulated
over time after the feeding.</p>
</div>
<div class="section level2">
<h2 id="load-the-packages">Load the packages<a class="anchor" aria-label="anchor" href="#load-the-packages"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SplineOmics</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org" class="external-link">readxl</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="load-the-files">Load the files<a class="anchor" aria-label="anchor" href="#load-the-files"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"data.xlsx"</span>, package <span class="op">=</span> <span class="st">"SplineOmics"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">annotation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"annotation.xlsx"</span>, package <span class="op">=</span> <span class="st">"SplineOmics"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"meta.xlsx"</span>, package <span class="op">=</span> <span class="st">"SplineOmics"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7,162 × 36</span></span></span>
<span><span class="co">#&gt;    E09_TP01_Exponential E10_TP01_Exponential E12_TP01_Exponential</span></span>
<span><span class="co">#&gt;                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>                 15.3                 15.2                 15.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>                 14.5                 14.7                 14.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>                 16.0                 16.1                 16.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>                 16.2                 16.1                 16.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>                 15.1                 15.1                 15.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>                 14.6                 14.7                 14.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>                 15.0                 15.0                 15.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>                 14.8                 14.7                 14.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>                 20.5                 20.6                 20.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>                 16.4                 16.4                 16.4</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 7,152 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 33 more variables: E09_TP02_Exponential &lt;dbl&gt;, E10_TP02_Exponential &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   E12_TP02_Exponential &lt;dbl&gt;, E09_TP03_Exponential &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   E10_TP03_Exponential &lt;dbl&gt;, E12_TP03_Exponential &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   E09_TP04_Exponential &lt;dbl&gt;, E10_TP04_Exponential &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   E12_TP04_Exponential &lt;dbl&gt;, E09_TP05_Exponential &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   E10_TP05_Exponential &lt;dbl&gt;, E12_TP05_Exponential &lt;dbl&gt;, …</span></span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">annotation</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7,162 × 6</span></span></span>
<span><span class="co">#&gt;    `Potential contaminant` Protein.Group         Protein.Ids Protein.Names Genes</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> <span style="color: #BB0000;">NA</span>                      A0A8C2MV03;A0A8C2N2L3 A0A8C2MV03… A0A8C2MV03_C… Abhd4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> <span style="color: #BB0000;">NA</span>                      A0A8C2N4G8            A0A8C2N4G8  A0A8C2N4G8_C… Gbe1 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> <span style="color: #BB0000;">NA</span>                      G3GR83                G3GR83      G3GR83_CRIGR  Akr1…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> <span style="color: #BB0000;">NA</span>                      A0A098KX95            A0A098KX95  A0A098KX95_C… Agpa…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> <span style="color: #BB0000;">NA</span>                      G3HGQ9                G3HGQ9      G3HGQ9_CRIGR  Agpa…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> <span style="color: #BB0000;">NA</span>                      A0A8C2MM23            A0A8C2MM23  A0A8C2MM23_C… Agpa…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> <span style="color: #BB0000;">NA</span>                      G3H8X2                G3H8X2      G3H8X2_CRIGR  Agpa…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> <span style="color: #BB0000;">NA</span>                      A0A8C2MXW6            A0A8C2MXW6… A0A8C2MXW6_C… <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> <span style="color: #BB0000;">NA</span>                      A0A061HUZ2            A0A061HUZ2  A0A061HUZ2_C… H671…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> <span style="color: #BB0000;">NA</span>                      A0A8C2MC97            A0A8C2MC97  A0A8C2MC97_C… Plcb3</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 7,152 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: First.Protein.Description &lt;chr&gt;</span></span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">meta</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 36 × 5</span></span></span>
<span><span class="co">#&gt;    Sample.ID            Reactor Time.Point Phase        Time</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> E09_TP01_Exponential E09     TP01       Exponential   -<span style="color: #BB0000;">60</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> E10_TP01_Exponential E10     TP01       Exponential   -<span style="color: #BB0000;">60</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> E12_TP01_Exponential E12     TP01       Exponential   -<span style="color: #BB0000;">60</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> E09_TP02_Exponential E09     TP02       Exponential    15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> E10_TP02_Exponential E10     TP02       Exponential    15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> E12_TP02_Exponential E12     TP02       Exponential    15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> E09_TP03_Exponential E09     TP03       Exponential    60</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> E10_TP03_Exponential E10     TP03       Exponential    60</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> E12_TP03_Exponential E12     TP03       Exponential    60</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> E09_TP04_Exponential E09     TP04       Exponential    90</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 26 more rows</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="perform-eda-exploratory-data-analysis">Perform EDA (exploratory data analysis)<a class="anchor" aria-label="anchor" href="#perform-eda-exploratory-data-analysis"></a>
</h2>
<p>The first step in analysing data is usually EDA. EDA involves
summarizing the main characteristics of the data, often using plots.
This can involve densitiy distributions, boxplots, PCA, correlation
heatmaps, and more. This process can be carried out by using the package
function explore_data(). The necessary arguments are the data matrix
(data), the meta table (meta), the name of the column that contains the
levels of the experiment (condition) (the levels here are Exponential
and Stationary), and the report_info list, that contains general info
about the analysis. Optional arguments are meta_batch_column and
meta_batch2_column, that allow to specify the column name that contain
batch effect 1 and 2. These columns will be used to run the
removeBatchEffect function of limma to remove the batch effect of the
data for plotting. When at least one batch column is provided like this,
the function will not just generate one EDA HTML report, but two. One
for the uncorrected data, and one for the batch corrected data. These
reports are written either in the current working dir as default
location, or to a location specified with the optional argument
report_dir. The function also returns all plots generated. Lastly, if it
is desired that no report should be generated, the optional argument
report can be set to FALSE.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">report_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  omics_data_type <span class="op">=</span> <span class="st">"PTX"</span>,</span>
<span>  data_description <span class="op">=</span> <span class="st">"Proteomics data of CHO cells"</span>,</span>
<span>  data_collection_date <span class="op">=</span> <span class="st">"February 2024"</span>,</span>
<span>  analyst_name <span class="op">=</span> <span class="st">"Thomas Rauter"</span>,</span>
<span>  contact_info <span class="op">=</span> <span class="st">"thomas.rauter@plus.ac.at"</span>,</span>
<span>  project_name <span class="op">=</span> <span class="st">"DGTX"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">condition</span> <span class="op">&lt;-</span> <span class="st">"Phase"</span></span>
<span><span class="va">meta_batch_column</span> <span class="op">&lt;-</span> <span class="st">"Reactor"</span></span>
<span></span>
<span><span class="va">report_dir</span> <span class="op">&lt;-</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"results"</span>, <span class="st">"explore_data"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/explore_data.html">explore_data</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>,</span>
<span>                      meta <span class="op">=</span> <span class="va">meta</span>,</span>
<span>                      condition <span class="op">=</span> <span class="va">condition</span>,</span>
<span>                      report_info <span class="op">=</span> <span class="va">report_info</span>,</span>
<span>                      meta_batch_column <span class="op">=</span> <span class="va">meta_batch_column</span>,</span>
<span>                      report_dir <span class="op">=</span> <span class="va">report_dir</span><span class="op">)</span></span></code></pre></div>
<p>You can view the generated analysis report of the
not-batch-corrected-data here: <a href="../inst/reports/report.html">here</a></p>
<p>The EDA plots can tell you a range of things. The plots in the HTML
report are grouped into three categories: Distribution and Variability
Analysis, Time Series Analysis, and Dimensionality Reduction and
Clustering.</p>
</div>
<div class="section level2">
<h2 id="find-the-best-hyperparameters">Find the best hyperparameters<a class="anchor" aria-label="anchor" href="#find-the-best-hyperparameters"></a>
</h2>
<p>Before we can run the limma spline analysis, we have to find out
which “hyperparameters” are the best. Hyperparameters in this context
are for example degree of freedom, different versions of the data
(outlier removed vs. not removed), different limma design formulas, etc.
Rationally thinking about which combination of hyperparameters to use is
very challenging. Instead, it is often better to just try out a bunch of
combinations and choose the best. The function
screen_limma_hyperparams() does this for you. For each hyperparameter,
you can just specify all the values that you would like to try, and the
function then runs the limma spline analysis with the combinations that
can be formed with the hyperparameters that you specified. Not every
single combo is generated, but instead there are “inner” and “outer”
hyperparameters, and only for all “outer” hyperparameters, all combos
are generated. The “inner” hyperparameters are the adj. p-value
thresholds and the spline parameters. For example, if you have two
different versions of one dataset (one time the full dataset, and one
time the dataset with some potential outliers removed), these are
considered “outer” hyperparameters in this context. The function would
generate all possible comparisons for the “outer” hyperparameters, which
is just a single comparison. Then, for both versions of the data, every
“inner” hyperparameter combo is generated. Lets say you specified
natural cubic splines for both, with a degree of freedom of either 2 or
3. For the adj. p-value threshold, you specified 0.05 or 0.1. For each
version of data, it would test out all combinations of the spline
parameters and the adj. p-value threshold. In this case, this is DoF =
2, thesh = 0.05; DoF = 3, tresh = 0.05; DoF = 2, tresh = 0.1; DoF = 3,
tresh = 0.1.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data1</span> <span class="op">&lt;-</span> <span class="va">data</span> </span>
<span><span class="va">meta1</span> <span class="op">&lt;-</span> <span class="va">meta</span></span>
<span></span>
<span><span class="co"># (These are not outliers, just removed to showcase this functionality)</span></span>
<span><span class="va">data2</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">meta2</span> <span class="op">&lt;-</span> <span class="va">meta</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">datas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">data1</span>, <span class="va">data2</span><span class="op">)</span> </span>
<span><span class="va">datas_descr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"full_data"</span>, <span class="st">"outliers_removed"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">metas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">meta1</span>, <span class="va">meta2</span><span class="op">)</span> </span>
<span><span class="va">designs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~ 1 + Phase*X + Reactor"</span>, <span class="st">"~ 1 + X + Reactor"</span><span class="op">)</span> </span>
<span><span class="va">condition</span> <span class="op">&lt;-</span> <span class="st">"Phase"</span> </span>
<span><span class="va">report_dir</span> <span class="op">&lt;-</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"results"</span>, <span class="st">"hyperparams_screen_reports"</span><span class="op">)</span> </span>
<span><span class="va">meta_batch_column</span> <span class="op">=</span> <span class="st">"Reactor"</span> </span>
<span><span class="va">pthresholds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Every row a combo to test.</span></span>
<span><span class="va">spline_test_configs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>spline_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n"</span>, <span class="st">"n"</span>, <span class="st">"n"</span>, <span class="st">"n"</span><span class="op">)</span>,</span>
<span>                                  degree <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>                                  dof <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2L</span>, <span class="fl">3L</span>, <span class="fl">4L</span>, <span class="fl">5L</span><span class="op">)</span>,</span>
<span>                                  knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,                                                        bknots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/screen_limma_hyperparams.html">screen_limma_hyperparams</a></span><span class="op">(</span><span class="va">datas</span>,</span>
<span>                         <span class="va">datas_descr</span>,</span>
<span>                         <span class="va">metas</span>,</span>
<span>                         <span class="va">designs</span>,</span>
<span>                         <span class="va">condition</span>,</span>
<span>                         <span class="va">spline_test_configs</span>,</span>
<span>                         <span class="va">report_info</span>,</span>
<span>                         <span class="va">report_dir</span>,</span>
<span>                         <span class="va">pthresholds</span>,</span>
<span>                         <span class="va">meta_batch_column</span><span class="op">)</span></span></code></pre></div>
<p>To see the output HTML report, click here: <a href="../inst/reports/hyperparams_screen_report.html">here</a></p>
</div>
<div class="section level2">
<h2 id="run-limma-spline-analysis">Run limma spline analysis<a class="anchor" aria-label="anchor" href="#run-limma-spline-analysis"></a>
</h2>
<p>Once we identified the hyperparameters, that are likely the best
ones, we can run the limma spline analysis with them and get the
results.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">design</span> <span class="op">&lt;-</span> <span class="st">"~ 1 + Phase*X + Reactor"</span>     <span class="co"># Chosen limma design</span></span>
<span></span>
<span><span class="va">spline_params</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>spline_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n"</span><span class="op">)</span>,  <span class="co"># Chosen spline parameters</span></span>
<span>                     dof <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2L</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run the limma spline analysis</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_limma_splines.html">run_limma_splines</a></span><span class="op">(</span><span class="va">data</span>,   <span class="co"># Chosen version of the data</span></span>
<span>                            <span class="va">meta</span>,</span>
<span>                            <span class="va">design</span>,</span>
<span>                            spline_params <span class="op">=</span> <span class="va">spline_params</span>,</span>
<span>                            <span class="va">condition</span><span class="op">)</span></span>
<span><span class="co">#&gt; Interaction terms identified in limma design formula. Selecting mode == integrated. This means that all levels are analysed using the full data.</span></span>
<span><span class="co">#&gt; The time values do not change consistently after the replicates.</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">top_tables1</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">time_effect</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">top_tables1</span><span class="op">)</span></span>
<span><span class="co">#&gt; $Phase_Exponential</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7,162 × 9</span></span></span>
<span><span class="co">#&gt;         X1      X2 AveExpr     F   P.Value adj.P.Val feature_index feature_names</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  0.136   0.222     20.5  19.4   3.61<span style="color: #949494;">e</span><span style="color: #BB0000;">-6</span>   0.009<span style="text-decoration: underline;">90</span>          <span style="text-decoration: underline;">5</span>683 5683         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> -<span style="color: #BB0000;">0.177</span>   0.242     20.9  17.1   1.03<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>   0.009<span style="text-decoration: underline;">90</span>           110 110          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  0.071<span style="text-decoration: underline;">6</span>  0.408     18.5  17.0   1.07<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>   0.009<span style="text-decoration: underline;">90</span>          <span style="text-decoration: underline;">3</span>253 3253         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  0.045<span style="text-decoration: underline;">7</span> -<span style="color: #BB0000;">0.216</span>     16.2  16.6   1.30<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>   0.009<span style="text-decoration: underline;">90</span>          <span style="text-decoration: underline;">2</span>861 2861         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> -<span style="color: #BB0000;">0.036</span><span style="color: #BB0000; text-decoration: underline;">5</span>  0.203     17.8  16.6   1.31<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>   0.009<span style="text-decoration: underline;">90</span>          <span style="text-decoration: underline;">2</span>514 2514         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  0.070<span style="text-decoration: underline;">7</span>  0.248     21.6  16.6   1.33<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>   0.009<span style="text-decoration: underline;">90</span>          <span style="text-decoration: underline;">5</span>321 5321         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  0.250   0.154     17.3  16.4   1.46<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>   0.009<span style="text-decoration: underline;">90</span>          <span style="text-decoration: underline;">6</span>689 6689         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> -<span style="color: #BB0000;">0.644</span>  -<span style="color: #BB0000;">0.079</span><span style="color: #BB0000; text-decoration: underline;">0</span>    14.3  16.4   1.46<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>   0.009<span style="text-decoration: underline;">90</span>          <span style="text-decoration: underline;">6</span>127 6127         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> -<span style="color: #BB0000;">0.376</span>  -<span style="color: #BB0000;">0.408</span>     16.2  16.3   1.50<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>   0.009<span style="text-decoration: underline;">90</span>           213 213          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  0.128  -<span style="color: #BB0000;">0.116</span>     15.4  16.3   1.50<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>   0.009<span style="text-decoration: underline;">90</span>          <span style="text-decoration: underline;">4</span>067 4067         </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 7,152 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: intercept &lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Phase_Stationary</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7,162 × 9</span></span></span>
<span><span class="co">#&gt;         X1      X2 AveExpr     F   P.Value adj.P.Val feature_index feature_names</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> -<span style="color: #BB0000;">0.656</span>  -<span style="color: #BB0000;">0.375</span>     14.3  26.8   1.85<span style="color: #949494;">e</span><span style="color: #BB0000;">-7</span>   0.001<span style="text-decoration: underline;">33</span>          <span style="text-decoration: underline;">6</span>127 6127         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> -<span style="color: #BB0000;">0.360</span>  -<span style="color: #BB0000;">0.221</span>     15.5  16.2   1.62<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>   0.034<span style="text-decoration: underline;">5</span>           <span style="text-decoration: underline;">1</span>465 1465         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> -<span style="color: #BB0000;">0.313</span>  -<span style="color: #BB0000;">0.129</span>     17.6  16.0   1.71<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>   0.034<span style="text-decoration: underline;">5</span>           <span style="text-decoration: underline;">2</span>722 2722         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> -<span style="color: #BB0000;">0.363</span>  -<span style="color: #BB0000;">0.107</span>     19.2  15.8   1.92<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>   0.034<span style="text-decoration: underline;">5</span>           <span style="text-decoration: underline;">6</span>549 6549         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> -<span style="color: #BB0000;">1.13</span>   -<span style="color: #BB0000;">0.769</span>     11.7  15.3   2.41<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>   0.034<span style="text-decoration: underline;">5</span>           <span style="text-decoration: underline;">1</span>231 1231         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  0.267   0.087<span style="text-decoration: underline;">8</span>    14.5  12.8   8.95<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>   0.107            <span style="text-decoration: underline;">1</span>092 1092         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  0.081<span style="text-decoration: underline;">5</span> -<span style="color: #BB0000;">0.254</span>     13.9  12.3   1.21<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span>   0.110            <span style="text-decoration: underline;">5</span>503 5503         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> -<span style="color: #BB0000;">0.432</span>  -<span style="color: #BB0000;">0.189</span>     15.1  12.3   1.22<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span>   0.110            <span style="text-decoration: underline;">1</span>399 1399         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> -<span style="color: #BB0000;">0.815</span>  -<span style="color: #BB0000;">0.503</span>     16.8  11.9   1.51<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span>   0.120            <span style="text-decoration: underline;">3</span>187 3187         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  0.824   0.461     11.3  11.3   2.07<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span>   0.148            <span style="text-decoration: underline;">4</span>277 4277         </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 7,152 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: intercept &lt;dbl&gt;</span></span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">top_tables2</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">avrg_diff_conditions</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">top_tables2</span><span class="op">)</span></span>
<span><span class="co">#&gt; $avrg_diff_Exponential_vs_Stationary</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7,162 × 9</span></span></span>
<span><span class="co">#&gt;    logFC AveExpr     t  P.Value adj.P.Val     B feature_index feature_names</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> -<span style="color: #BB0000;">2.85</span>    17.1 -<span style="color: #BB0000;">55.5</span> 2.71<span style="color: #949494;">e</span><span style="color: #BB0000;">-32</span>  1.94<span style="color: #949494;">e</span><span style="color: #BB0000;">-28</span>  63.2          <span style="text-decoration: underline;">6</span>548 6548         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> -<span style="color: #BB0000;">1.26</span>    16.6 -<span style="color: #BB0000;">45.8</span> 8.78<span style="color: #949494;">e</span><span style="color: #BB0000;">-30</span>  3.14<span style="color: #949494;">e</span><span style="color: #BB0000;">-26</span>  57.8          <span style="text-decoration: underline;">1</span>156 1156         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> -<span style="color: #BB0000;">1.51</span>    15.9 -<span style="color: #BB0000;">41.5</span> 1.71<span style="color: #949494;">e</span><span style="color: #BB0000;">-28</span>  4.09<span style="color: #949494;">e</span><span style="color: #BB0000;">-25</span>  55.0          <span style="text-decoration: underline;">2</span>623 2623         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> -<span style="color: #BB0000;">2.63</span>    15.0 -<span style="color: #BB0000;">40.7</span> 3.04<span style="color: #949494;">e</span><span style="color: #BB0000;">-28</span>  5.44<span style="color: #949494;">e</span><span style="color: #BB0000;">-25</span>  54.4           822 822          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> -<span style="color: #BB0000;">2.52</span>    15.3 -<span style="color: #BB0000;">39.1</span> 1.01<span style="color: #949494;">e</span><span style="color: #BB0000;">-27</span>  1.44<span style="color: #949494;">e</span><span style="color: #BB0000;">-24</span>  53.3          <span style="text-decoration: underline;">4</span>129 4129         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> -<span style="color: #BB0000;">1.81</span>    16.1 -<span style="color: #BB0000;">38.5</span> 1.63<span style="color: #949494;">e</span><span style="color: #BB0000;">-27</span>  1.95<span style="color: #949494;">e</span><span style="color: #BB0000;">-24</span>  52.8          <span style="text-decoration: underline;">1</span>123 1123         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> -<span style="color: #BB0000;">2.72</span>    14.3 -<span style="color: #BB0000;">37.0</span> 5.42<span style="color: #949494;">e</span><span style="color: #BB0000;">-27</span>  5.55<span style="color: #949494;">e</span><span style="color: #BB0000;">-24</span>  51.7          <span style="text-decoration: underline;">1</span>098 1098         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> -<span style="color: #BB0000;">2.10</span>    14.2 -<span style="color: #BB0000;">36.6</span> 7.45<span style="color: #949494;">e</span><span style="color: #BB0000;">-27</span>  6.67<span style="color: #949494;">e</span><span style="color: #BB0000;">-24</span>  51.3          <span style="text-decoration: underline;">3</span>158 3158         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> -<span style="color: #BB0000;">2.34</span>    16.1 -<span style="color: #BB0000;">35.4</span> 2.02<span style="color: #949494;">e</span><span style="color: #BB0000;">-26</span>  1.61<span style="color: #949494;">e</span><span style="color: #BB0000;">-23</span>  50.4          <span style="text-decoration: underline;">3</span>155 3155         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> -<span style="color: #BB0000;">2.71</span>    14.6 -<span style="color: #BB0000;">35.3</span> 2.32<span style="color: #949494;">e</span><span style="color: #BB0000;">-26</span>  1.66<span style="color: #949494;">e</span><span style="color: #BB0000;">-23</span>  50.2          <span style="text-decoration: underline;">2</span>955 2955         </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 7,152 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: intercept &lt;dbl&gt;</span></span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">top_tables3</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">interaction_condition_time</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">top_tables3</span><span class="op">)</span> </span>
<span><span class="co">#&gt; $time_interaction_Exponential_vs_Stationary</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7,162 × 9</span></span></span>
<span><span class="co">#&gt;    PhaseStationary.X1 PhaseStationary.X2 AveExpr     F   P.Value adj.P.Val</span></span>
<span><span class="co">#&gt;                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>             -<span style="color: #BB0000;">0.519</span>             0.147     14.1 14.1  0.000<span style="text-decoration: underline;">045</span>8     0.328</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>              1.51             -<span style="color: #BB0000;">0.062</span><span style="color: #BB0000; text-decoration: underline;">2</span>    12.4 12.3  0.000<span style="text-decoration: underline;">117</span>      0.394</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>              2.71              0.698     12.9 11.7  0.000<span style="text-decoration: underline;">171</span>      0.394</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>             -<span style="color: #BB0000;">0.223</span>             0.210     15.3 10.8  0.000<span style="text-decoration: underline;">280</span>      0.394</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>              0.967             0.014<span style="text-decoration: underline;">5</span>    13.5 10.7  0.000<span style="text-decoration: underline;">298</span>      0.394</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>              0.510             0.115     16.5 10.2  0.000<span style="text-decoration: underline;">401</span>      0.394</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>              1.13             -<span style="color: #BB0000;">0.240</span>     12.3  9.72 0.000<span style="text-decoration: underline;">538</span>      0.394</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>             -<span style="color: #BB0000;">0.121</span>            -<span style="color: #BB0000;">0.179</span>     15.9  9.72 0.000<span style="text-decoration: underline;">539</span>      0.394</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>             -<span style="color: #BB0000;">0.311</span>            -<span style="color: #BB0000;">0.144</span>     17.3  9.71 0.000<span style="text-decoration: underline;">542</span>      0.394</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>              0.602             0.302     12.8  9.69 0.000<span style="text-decoration: underline;">550</span>      0.394</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 7,152 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3 more variables: feature_index &lt;int&gt;, feature_names &lt;chr&gt;, intercept &lt;dbl&gt;</span></span></span></code></pre></div>
<p>The output of the function run_limma_splines() is a named list, where
each element is a specific “category” of results. Each of those elements
is a list, containing as elements the respective limma topTables, either
for each level or each comparison between two levels.</p>
<p>The element “time_effect” is a list, where each element is the
topTable where the p-value for each feature for the respective level are
reported.</p>
<p>The element “avrg_diff_conditions” is a list that contains as
elements the topTables, that represent the comparison of the average
differences of the levels.</p>
<p>The element “interaction_condition_time” is a list that contains as
elements the topTables, that represent the interaction between the
levels (which includes both time and the average differences)</p>
</div>
<div class="section level2">
<h2 id="build-limma-report">Build limma report<a class="anchor" aria-label="anchor" href="#build-limma-report"></a>
</h2>
<p>The topTables of all three categories can be used to generate p-value
histograms an volcano plots.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">report_dir</span> <span class="op">&lt;-</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"results"</span>, <span class="st">"create_limma_reports"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/create_limma_report.html">create_limma_report</a></span><span class="op">(</span>run_limma_splines_result <span class="op">=</span> <span class="va">result</span>,</span>
<span>                    report_info <span class="op">=</span> <span class="va">report_info</span>,</span>
<span>                    report_dir <span class="op">=</span> <span class="va">report_dir</span><span class="op">)</span></span></code></pre></div>
<p>You can view the generated analysis report of the create_limma_report
function here: <a href="../inst/reports/create_limma_report.html">here</a></p>
</div>
<div class="section level2">
<h2 id="cluster-the-hits-significant-features">Cluster the hits (significant features)<a class="anchor" aria-label="anchor" href="#cluster-the-hits-significant-features"></a>
</h2>
<p>After we obtained the limma spline results, we can cluster the hits
based on their temporal pattern (their spline shape). We define what a
hit is by setting an adj. p-value threshold for every level. Then,
hierarchical clustering is used to place every hit in one of as many
clusters as we have specified for that specific level.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adj_pthresholds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.05</span><span class="op">)</span>   </span>
<span><span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">2L</span>, <span class="fl">2L</span><span class="op">)</span>   </span>
<span><span class="va">report_dir</span> <span class="op">&lt;-</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"results"</span>, <span class="st">"clustering_reports"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">clustering_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cluster_hits.html">cluster_hits</a></span><span class="op">(</span>top_tables <span class="op">=</span> <span class="va">top_tables1</span>, </span>
<span>                                   data <span class="op">=</span> <span class="va">data</span>, </span>
<span>                                   meta <span class="op">=</span> <span class="va">meta</span>, </span>
<span>                                   design <span class="op">=</span> <span class="va">design</span>,</span>
<span>                                   condition <span class="op">=</span> <span class="va">condition</span>, </span>
<span>                                   spline_params <span class="op">=</span> <span class="va">spline_params</span>,</span>
<span>                                   adj_pthresholds <span class="op">=</span> <span class="va">adj_pthresholds</span>,</span>
<span>                                   clusters <span class="op">=</span> <span class="va">clusters</span>,</span>
<span>                                   report_info <span class="op">=</span> <span class="va">report_info</span>,</span>
<span>                                   meta_batch_column <span class="op">=</span> <span class="va">meta_batch_column</span>,</span>
<span>                                   report_dir <span class="op">=</span> <span class="va">report_dir</span>,</span>
<span>                                   report <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Interaction terms identified in limma design formula. Selecting mode == integrated. This means that all levels are analysed using the full data.</span></span>
<span><span class="co">#&gt; The time values do not change consistently after the replicates.</span></span>
<span><span class="co">#&gt; Column 'Reactor' of meta will be used to remove the batch effect for the plotting</span></span>
<span><span class="co">#&gt; [1] "Generating report. This takes a few seconds."</span></span></code></pre></div>
<p>To see the output HTML report, click here: <a href="../inst/reports/clustering_report.html">here</a></p>
</div>
<div class="section level2">
<h2 id="perform-gene-set-enrichment-analysis-gsea">Perform gene set enrichment analysis (GSEA)<a class="anchor" aria-label="anchor" href="#perform-gene-set-enrichment-analysis-gsea"></a>
</h2>
<p>To each clustered hit, the respective gene can be assigned and GSEA
performed. For this, the Enrichr databases of choice have to be
downloaded:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gene_set_lib</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WikiPathways_2019_Human"</span>,</span>
<span>                  <span class="st">"NCI-Nature_2016"</span>,</span>
<span>                  <span class="st">"TRRUST_Transcription_Factors_2019"</span>,</span>
<span>                  <span class="st">"MSigDB_Hallmark_2020"</span>,</span>
<span>                  <span class="st">"GO_Cellular_Component_2018"</span>,</span>
<span>                  <span class="st">"CORUM"</span>,</span>
<span>                  <span class="st">"KEGG_2019_Human"</span>,</span>
<span>                  <span class="st">"TRANSFAC_and_JASPAR_PWMs"</span>,</span>
<span>                  <span class="st">"ENCODE_and_ChEA_Consensus_TFs_from_ChIP-X"</span>,</span>
<span>                  <span class="st">"GO_Biological_Process_2018"</span>,</span>
<span>                  <span class="st">"GO_Molecular_Function_2018"</span>,</span>
<span>                  <span class="st">"Human_Gene_Atlas"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/download_enrichr_databases.html">download_enrichr_databases</a></span><span class="op">(</span><span class="va">gene_set_lib</span><span class="op">)</span></span></code></pre></div>
<p>Per default the file is placed in the current working directory,
which is the root dir of the R project.</p>
<p>To run GSEA, a genes vector has to be created, containing all the
underlying genes of the features. The downloaded database file has to be
loaded as a dataframe. Further, optionally, the clusterProfiler
parameters and the report dir can be specified. The function
create_gsea_report() runs GSEA using clusterProfiler, generates an HTML
report and returns the GSEA dotplots in R.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get gene vector</span></span>
<span><span class="va">gene_column_name</span> <span class="op">&lt;-</span> <span class="st">"Genes"</span></span>
<span><span class="va">genes</span> <span class="op">&lt;-</span> <span class="va">annotation</span><span class="op">[[</span><span class="va">gene_column_name</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">annotation</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">" .*"</span>, <span class="st">""</span>, <span class="va">genes</span><span class="op">)</span></span>
<span><span class="va">genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">";.*"</span>, <span class="st">""</span>, <span class="va">genes</span><span class="op">)</span></span>
<span><span class="va">genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"_.*"</span>, <span class="st">""</span>, <span class="va">genes</span><span class="op">)</span></span>
<span><span class="va">genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"-.*"</span>, <span class="st">""</span>, <span class="va">genes</span><span class="op">)</span></span>
<span></span>
<span><span class="va">downloaded_dbs_filepath</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"all_databases_08_04_2024-12_41_50.tsv"</span><span class="op">)</span></span>
<span><span class="va">databases</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_tsv</a></span><span class="op">(</span><span class="va">downloaded_dbs_filepath</span>, col_types <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html" class="external-link">cols</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">clusterProfiler_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>adj_p_value <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>                               pAdjustMethod <span class="op">=</span> <span class="st">"BH"</span>,</span>
<span>                               minGSSize <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                               maxGSSize <span class="op">=</span> <span class="fl">500</span>,</span>
<span>                               qvalueCutoff <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">report_dir</span> <span class="op">&lt;-</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"results"</span>, <span class="st">"gsea_reports"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_gsea_report.html">create_gsea_report</a></span><span class="op">(</span>levels_clustered_hits <span class="op">=</span> </span>
<span>                                  <span class="va">clustering_results</span><span class="op">$</span><span class="va">clustered_hits_levels</span>,</span>
<span>                             genes <span class="op">=</span> <span class="va">genes</span>,</span>
<span>                             databases <span class="op">=</span> <span class="va">databases</span>,</span>
<span>                             params <span class="op">=</span> <span class="va">clusterProfiler_params</span>,</span>
<span>                             report_info <span class="op">=</span> <span class="va">report_info</span>,</span>
<span>                             report_dir <span class="op">=</span> <span class="va">report_dir</span><span class="op">)</span></span></code></pre></div>
<p>To see the output HTML report, click here: <a href="../inst/reports/gsea_report.html">here</a></p>
<p>Every row in the dotplots is a term from a specific database, and the
columns are the respective clusters. The color scale contains the info
about the odds ratio and the size the -log10 adj. p-value. Only terms
that have &gt; 2 genes as support are included in the plot. Further, for
each cluster, just maximally 5 terms are shown (the terms with the
highest odds ratios). Note that when for example cluster 1 already has 5
terms, and cluster 2 does not, and gets a term which was also found for
cluster 1, than this term would be included as the sixth term for
cluster 1, so this is a way the maximum of 5 can be exceeded.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Thomas Rauter.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
