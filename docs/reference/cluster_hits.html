<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Cluster the significant features based on spline similarity — cluster_hits • SplineOmics</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Cluster the significant features based on spline similarity — cluster_hits"><meta name="description" content="Performs clustering on hits from top tables generated by differential
expression analysis.
This function filters hits based on adjusted p-value thresholds, extracts
spline coefficients for
significant features, normalizes these coefficients, and applies hierarchical
clustering. The results,
including clustering assignments and normalized spline curves, are saved in a
specified directory and
compiled into an HTML report."><meta property="og:description" content="Performs clustering on hits from top tables generated by differential
expression analysis.
This function filters hits based on adjusted p-value thresholds, extracts
spline coefficients for
significant features, normalizes these coefficients, and applies hierarchical
clustering. The results,
including clustering assignments and normalized spline curves, are saved in a
specified directory and
compiled into an HTML report."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SplineOmics</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/get_started.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><h6 class="dropdown-header" data-toc-skip>Further use cases</h6></li>
    <li><a class="dropdown-item" href="../articles/RNA-seq-analysis.html">RNA-seq analysis</a></li>
    <li><a class="dropdown-item" href="../articles/glycan-analysis.html">Glycan analysis</a></li>
    <li><a class="dropdown-item" href="../articles/methylation_data_analysis.html">Epigenetics analysis</a></li>
    <li><a class="dropdown-item" href="../articles/PVC_analysis.html">Peak-Valley-Cliff (PVC) analysis</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/limma_result_categories.html">limma result categories</a></li>
    <li><a class="dropdown-item" href="../articles/design_limma_design_formula.html">Designing a limma design formula</a></li>
    <li><a class="dropdown-item" href="../articles/Docker-instructions.html">Docker container instructions</a></li>
    <li><a class="dropdown-item" href="../articles/Docker_permission_denied.html">Docker permission denied</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../articles/faq.html">FAQ</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/CHANGELOG.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/csbg/SplineOmics/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Cluster the significant features based on spline similarity</h1>
      <small class="dont-index">Source: <a href="https://github.com/csbg/SplineOmics/blob/HEAD/R/cluster_hits.R" class="external-link"><code>R/cluster_hits.R</code></a></small>
      <div class="d-none name"><code>cluster_hits.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Performs clustering on hits from top tables generated by differential
expression analysis.
This function filters hits based on adjusted p-value thresholds, extracts
spline coefficients for
significant features, normalizes these coefficients, and applies hierarchical
clustering. The results,
including clustering assignments and normalized spline curves, are saved in a
specified directory and
compiled into an HTML report.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">cluster_hits</span><span class="op">(</span></span>
<span>  <span class="va">splineomics</span>,</span>
<span>  <span class="va">nr_clusters</span>,</span>
<span>  adj_pthresh_time_effect <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  adj_pthresh_avrg_diff_conditions <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  adj_pthresh_interaction_condition_time <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  min_effect_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>time_effect <span class="op">=</span> <span class="fl">0</span>, avg_diff_cond <span class="op">=</span> <span class="fl">0</span>, interaction_cond_time <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>  genes <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  plot_info <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y_axis_label <span class="op">=</span> <span class="st">"Value"</span>, time_unit <span class="op">=</span> <span class="st">"min"</span>, treatment_labels <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>    treatment_timepoints <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>  plot_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cluster_heatmap_columns <span class="op">=</span> <span class="cn">FALSE</span>, meta_replicate_column <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>,</span>
<span>  raw_data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  report_dir <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  max_hit_number <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-splineomics">splineomics<a class="anchor" aria-label="anchor" href="#arg-splineomics"></a></dt>
<dd><p><code>SplineOmics</code>: An S3 object of class <code>SplineOmics</code> that
contains all the necessary data and parameters for the analysis, including:</p><ul><li><p><code>data</code>: <code>matrix</code> The data matrix with the values. The columns
are the samples (timepoint + replicate combo) and the rows are the
features (e.g. genes or proteins).</p></li>
<li><p><code>meta</code>: <code>data.frame</code> A dataframe containing metadata
corresponding to the <code>data</code>, must include a 'Time' column and any
columns specified by <code>conditions</code>. In general, the columns of meta
correspond to the different types of metadata, and each row corresponds to
a column of data (contains the metadata for that sample).</p></li>
<li><p><code>annotation</code>: <code>data.frame</code> A dataframe that maps the rows of
<code>data</code> to annotation info, such as the gene name or database
identifiers.</p></li>
<li><p><code>report_info</code>: <code>list</code> A named list describing the experiment.
Must include the following fields (<code>character(1)</code>):
- <code>"omics_data_type"</code>
- <code>"data_description"</code>
- <code>"data_collection_date"</code>
- <code>"analyst_name"</code>
- <code>"contact_info"</code>
- <code>"project_name"</code></p>
<p>May also include the following optional fields (<code>character(1)</code>):
- <code>"method_description"</code>
- <code>"results_summary"</code>
- <code>"conclusions"</code></p></li>
<li><p><code>design</code>: <code>character(1)</code> A character of length 1 representing
the limma design formula.</p></li>
<li><p><code>mode</code>: <code>character(1)</code> Specifies how the design formula is
constructed: either <code>"isolated"</code> or <code>"integrated"</code>.</p><ul><li><p><code>"isolated"</code>: Each level is analyzed independently, using only the
subset of data corresponding to that level. The design formula does not
include the condition variable, since only one condition is present in
each subset.</p></li>
<li><p><code>"integrated"</code>: All levels are analyzed together in a single model,
using the full dataset. The design formula includes the condition
variable (and optionally interaction terms with it) so that results are
estimated jointly across all levels.</p></li>
<li><p><code>condition</code>: <code>character(1)</code> Character vector of length 1
specifying the column name in <code>meta</code> used to define groups for
analysis.</p></li>
<li><p><code>spline_params</code>: <code>list</code> A list of spline parameters for the
analysis.</p></li>
<li><p><code>meta_batch_column</code>: <code>character(1)</code> A character string
specifying the column name in the metadata used for batch effect removal.</p></li>
<li><p><code>meta_batch2_column</code>: <code>character(1)</code> A character string
specifying the second column name in the metadata used for batch effect
removal.</p></li>
<li><p><code>limma_splines_result</code>: <code>list(data.frame)</code> and
<code>list(list(data.frame))</code> A list containing dataframes or lists of
dataframes. Each df represents a top table from the limma spline analysis
of the run_limma_splines() function that has to be run before.</p></li>
<li><p><code>feature_name_columns</code>: <code><a href="https://rdrr.io/r/base/character.html" class="external-link">character()</a></code> Character vector of
strings that each specify a column of the original data dataframe which
were used to automatically build the feature names with the
<code>extract_data</code> function.</p></li>
</ul></li>
</ul></dd>


<dt id="arg-nr-clusters">nr_clusters<a class="anchor" aria-label="anchor" href="#arg-nr-clusters"></a></dt>
<dd><p><code>list</code>: Named list specifying the number of clusters per
condition level. The list must have one element per condition level, and
each element must be named exactly with the corresponding condition name
(e.g., <code>"condition1"</code>, <code>"condition2"</code>).</p>
<p>Each element's value controls the <code>k</code> used by k-means for that level:</p><ul><li><p><strong>Single integer</strong> (<code>integer(1)</code>, <code>k &gt; 0</code>, e.g. <code>3</code>): use
exactly that many clusters.</p></li>
<li><p><strong>Integer range</strong> (<code><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer()</a></code>, written with <code>:</code>,
e.g. <code>2:6</code>): choose the <code>k</code> within the range that
<strong>minimizes the Bayesian Information Criterion (BIC)</strong> computed
from the k-means fit over that range (lower is better). Ties are broken
by the first minimum encountered.</p></li>
</ul><p><strong>Notes</strong></p><ul><li><p>All condition levels must be present exactly once as names.</p></li>
<li><p>Values must be positive integers; ranges must be increasing
(e.g. <code>2:6</code>).</p></li>
<li><p>BIC is computed from k-means using Euclidean distance. A common
form is \(\mathrm{BIC} = n \log(\mathrm{WCSS}/n) + k \log(n)\,
          p\), where \(n\) is the number of series, \(p\) the number of
timepoints (features), and \(\mathrm{WCSS}\) the total
within-cluster sum of squares for the fit.</p></li>
<li><p>Clustering will fail if the requested <code>k</code> is not strictly
less than the number of available series for that level.</p></li>
</ul><p><strong>Example</strong>
Fixed k for condition1, BIC-selected k for condition2
nr_clusters &lt;- list(
condition1 = 4,
condition2 = 2:6
)</p></dd>


<dt id="arg-adj-pthresh-time-effect">adj_pthresh_time_effect<a class="anchor" aria-label="anchor" href="#arg-adj-pthresh-time-effect"></a></dt>
<dd><p><code>numeric(1)</code>: adj. p-value threshold
for the limma time effect results (category 1).</p></dd>


<dt id="arg-adj-pthresh-avrg-diff-conditions">adj_pthresh_avrg_diff_conditions<a class="anchor" aria-label="anchor" href="#arg-adj-pthresh-avrg-diff-conditions"></a></dt>
<dd><p><code>numeric(1)</code>: adj. p-value threshold
for the limma average difference between conditions results (category 2).</p></dd>


<dt id="arg-adj-pthresh-interaction-condition-time">adj_pthresh_interaction_condition_time<a class="anchor" aria-label="anchor" href="#arg-adj-pthresh-interaction-condition-time"></a></dt>
<dd><p><code>numeric(1)</code>: adj. p-value
threshold for the limma interaction of condition and time results
(category 3).</p></dd>


<dt id="arg-min-effect-size">min_effect_size<a class="anchor" aria-label="anchor" href="#arg-min-effect-size"></a></dt>
<dd><p><code>list</code>: A named list that specifies the minimum
effect size thresholds to consider a feature as biologically meaningful, in
addition to statistical significance. This allows users to filter out
"trivial" hits that pass adjusted p-value cutoffs but show negligible effect
sizes.</p>
<p>The list must contain the following elements:</p><ul><li><p><code>time_effect</code>: <code>numeric(1)</code> Minimum cumulative travel for time effects
(Category 1). Features with a smaller travel will be ignored even if
significant.</p></li>
<li><p><code>avg_diff_cond</code>: <code>numeric(1)</code> Minimum absolute effect size for average
differences between conditions (Category 2). Ensures that only contrasts
with a relevant magnitude are reported.</p></li>
<li><p><code>interaction_cond_time</code>: <code>numeric(1)</code> Minimum effect size for the
interaction between condition and time (Category 3). This controls how
large the differential curve travel must be across conditions to count
as a hit.</p></li>
</ul><p>Values should be numeric scalars (typically &gt;0). For example:
<code>min_effect_size = list(time_effect = 1, avg_diff_cond = 1,  interaction_cond_time = 2)</code> will only keep features with cumulative
travels or condition-time differences above those cutoffs. Use smaller
values (e.g., 0.1) for permissive filtering, or larger values for more
conservative thresholds.</p>
<p>The default is 0 for all three elements.</p></dd>


<dt id="arg-genes">genes<a class="anchor" aria-label="anchor" href="#arg-genes"></a></dt>
<dd><p><code><a href="https://rdrr.io/r/base/character.html" class="external-link">character()</a></code>: A character vector of gene names corresponding
to the features to be analyzed. The order of entries must match the feature
order in <code>data</code>. Gene names should be standardized (cleaned) to ensure
compatibility with downstream databases used for overrepresentation
analysis after clustering.</p></dd>


<dt id="arg-plot-info">plot_info<a class="anchor" aria-label="anchor" href="#arg-plot-info"></a></dt>
<dd><p><code>list</code>: List with optional elements used to annotate spline
plots:</p><ul><li><p><code>y_axis_label</code>: <code>character(1)</code> single string for the y-axis label.</p></li>
<li><p><code>time_unit</code>: <code>character(1)</code> single string used in the x-axis label.</p></li>
<li><p><code>treatment_labels</code>: <code>list(character(1))</code> named list of single strings.</p></li>
<li><p><code>treatment_timepoints</code>: <code>list(numeric(1))</code> named list of single numeric
values.</p></li>
</ul><p>If any treatment list is present, both must be present. The two lists must
have identical name sets. Allowed names are the values of
<code>meta[[condition]]</code>. For the time effect spline plots of that condition, as
well as for all pairwise comparisons of the average difference between
conditions and interaction condition time results where the mentioned
condition appears, the treatment lines are inserted.</p>
<p>Vertical dashed lines are drawn at the given timepoints for facets whose
level name matches a list name, and labeled with the corresponding string
(e.g., feeding, temperature shift).</p>
<p>Example:</p>
<div class="sourceCode"><pre><code><span></span>
<span><span class="va">plot_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  y_axis_label <span class="op">=</span> <span class="st">"log2 expression"</span>,</span>
<span>  time_unit <span class="op">=</span> <span class="st">"hours"</span>,</span>
<span>  treatment_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    WT <span class="op">=</span> <span class="st">"Feeding"</span>,</span>
<span>    KO <span class="op">=</span> <span class="st">"Temperature shift"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  treatment_timepoints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    WT <span class="op">=</span> <span class="fl">12</span>,</span>
<span>    KO <span class="op">=</span> <span class="fl">24</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div></dd>


<dt id="arg-plot-options">plot_options<a class="anchor" aria-label="anchor" href="#arg-plot-options"></a></dt>
<dd><p><code>list</code>: A named list controlling optional plot
customization. The list can include one or both of the following entries
(any not supplied will fall back to their default values):</p><ul><li><p><code>cluster_heatmap_columns</code> <code>logical(1)</code> (default =
<code>FALSE</code>): Whether to cluster the columns in the heatmap.</p></li>
<li><p><code>meta_replicate_column</code> <code>character(1)</code> (default =
<code>NULL</code>): Name of the column in <code>meta</code> that encodes replicate
information. If supplied, spline plot data points are colored by
replicate, allowing replicate-level variation to be assessed.</p></li>
</ul></dd>


<dt id="arg-raw-data">raw_data<a class="anchor" aria-label="anchor" href="#arg-raw-data"></a></dt>
<dd><p><code>matrix</code>: Data matrix with the raw (unimputed) data, still
containing NA values. When provided, it highlights the datapoints in the
spline plots that originally where NA and that were imputed.</p></dd>


<dt id="arg-report-dir">report_dir<a class="anchor" aria-label="anchor" href="#arg-report-dir"></a></dt>
<dd><p><code>character(1)</code>: Character string specifying the directory
path where the HTML report and any other output files should be saved. When
no path is specified, then the function runs but no HTML report is generated.</p></dd>


<dt id="arg-max-hit-number">max_hit_number<a class="anchor" aria-label="anchor" href="#arg-max-hit-number"></a></dt>
<dd><p><code>integer(1)</code>: Maximum number of hits which are plotted
within each cluster. This can be used to limit the computation time and size
of the HTML report in the case of many hits.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p><code>logical(1)</code>: Boolean flag controlling the display of
messages.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A named list with three elements:</p><dl><dt><code>cluster_table</code></dt>
<dd><p>A tibble containing one row per <code>feature_nr</code> with metadata and
cluster assignments across the analysis categories. The structure is:</p><ul><li><p><code>feature_nr</code> - Numeric feature identifier.</p></li>
<li><p><code>feature_name</code> - Preferred feature name, prioritizing
values from the limma tables, then from the cluster table row
names, and falling back to the numeric feature ID.</p></li>
<li><p><code>gene</code> - Preferred gene symbol from the <code>annotation</code>
table if available, otherwise taken from the cluster tables.</p></li>
<li><p><code>cluster_&lt;cond1&gt;</code> / <code>cluster_&lt;cond2&gt;</code> - Cluster
assignments for each time-effect condition, named according to
the elements of <code>clustered_hits_levels</code>.</p></li>
<li><p><code>cluster_cat2</code> - Present only if category 2 results are
available; a combined cluster label in the form
<code>"&lt;cluster_&lt;cond1&gt;&gt;_&lt;cluster_&lt;cond2&gt;&gt;"</code> for features that
are significant in category 2. If this value is <code>NA</code>, the
feature was not a category 2 hit.</p></li>
<li><p><code>cluster_cat3</code> - Present only if category 3 results are
available; a combined cluster label in the form
<code>"&lt;cluster_&lt;cond1&gt;&gt;_&lt;cluster_&lt;cond2&gt;&gt;"</code> for features that
are significant in category 3. If this value is <code>NA</code>, the
feature was not a category 3 hit.</p></li>
</ul><p>For any category-specific cluster column (<code>cluster_&lt;cond1&gt;</code>,
<code>cluster_&lt;cond2&gt;</code>, <code>cluster_cat2</code>, <code>cluster_cat3</code>),
a value of <code>NA</code> indicates that the feature was not significant
(not a hit) in that category.</p></dd>

<dt><code>spline_results</code></dt>
<dd><p>A named list summarizing the fitted spline trajectories, their shared
time grid, and effect-size based significance flags. Structure:</p><dl><dt><code>time_grid</code></dt>
<dd><p>Numeric vector of length \(T\) giving the
common time points (e.g., hours since cultivation start) on which
all splines were predicted.</p></dd>

<dt><code>predictions</code></dt>
<dd><p>Named list by condition (e.g.,
<code>constant</code>, <code>temp_shift</code>). Each entry is a numeric
matrix of size \(N \times T\) with rows corresponding to features
and columns to <code>time_grid</code>. Values are the predicted spline
trajectories on the absolute scale used in the analysis
(e.g., log2-CPM after <code>voom</code>). Row order matches the feature
order used throughout the analysis.</p></dd>

<dt><code>time_effect_effect_size</code></dt>
<dd><p>Named list by condition with a
numeric vector (length \(N\)) per condition giving the
<em>cumulative travel</em> (integrated temporal change) of each
feature`s spline across <code>time_grid</code>. Larger values indicate
stronger within-condition temporal modulation.</p></dd>

<dt><code>time_effect_passed_threshold</code></dt>
<dd><p>Named list by condition
with a logical vector (length \(N\)) per condition indicating
whether the corresponding <code>time_effect_effect_size</code> exceeds
the user-defined effect-size threshold (i.e., time-effect hits).</p></dd>

<dt><code>interaction_effect_size</code></dt>
<dd><p>Numeric vector (length \(N\))
giving the <em>differential cumulative travel</em> between the two
condition-specific splines of each feature, computed on the same
<code>time_grid</code>. Larger values indicate stronger differences in
temporal behaviour between conditions (condition-time interaction).</p></dd>

<dt><code>interaction_passed_threshold</code></dt>
<dd><p>Logical vector (length
\(N\)) indicating whether <code>interaction_effect_size</code>
exceeds the interaction effect-size threshold (i.e., features with
significantly different temporal profiles across conditions).</p></dd>


</dl><p>Unless stated otherwise, vectors are aligned to the same feature order
used in the prediction matrices; condition names match
<code>levels(meta[[condition]])</code>.</p></dd>

<dt><code>plots</code></dt>
<dd><p>A list of all plots generated during the run, corresponding to the
visualizations shown in the HTML report produced by this function.
Additionally, this plots list also contains the plots showing the
consensus clusters of the potential clustering of the interaction of
condition and time (category 3) hits.</p></dd>


</dl></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Toy data: 4 features x 6 samples (two conditions, three time points)</span></span></span>
<span class="r-in"><span><span class="va">toy_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">8</span>, <span class="fl">12</span>, <span class="fl">17</span>, <span class="fl">23</span>, <span class="co"># f1</span></span></span>
<span class="r-in"><span>        <span class="fl">23</span>, <span class="fl">17</span>, <span class="fl">13</span>, <span class="fl">9</span>, <span class="fl">6</span>, <span class="fl">4</span>, <span class="co"># f2</span></span></span>
<span class="r-in"><span>        <span class="fl">5</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="co"># f3</span></span></span>
<span class="r-in"><span>        <span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">9</span>, <span class="fl">8</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="co"># f4</span></span></span>
<span class="r-in"><span>        <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="co"># f5</span></span></span>
<span class="r-in"><span>        <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">9</span>, <span class="fl">12</span>, <span class="fl">15</span>, <span class="co"># f6</span></span></span>
<span class="r-in"><span>        <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">7</span>, <span class="fl">10</span>, <span class="fl">14</span>, <span class="fl">19</span>, <span class="co"># f7</span></span></span>
<span class="r-in"><span>        <span class="fl">12</span>, <span class="fl">11</span>, <span class="fl">9</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">12</span> <span class="co"># f8</span></span></span>
<span class="r-in"><span>    <span class="op">)</span>,</span></span>
<span class="r-in"><span>    nrow <span class="op">=</span> <span class="fl">8</span>, ncol <span class="op">=</span> <span class="fl">6</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>    dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"f"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"s"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">toy_meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    Time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WT"</span>, <span class="st">"KO"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    Replicate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"R1"</span>, <span class="st">"R2"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    row.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">toy_data</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">toy_annot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    feature_nr <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span>,</span></span>
<span class="r-in"><span>    gene <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"G1"</span>, <span class="st">"G2"</span>, <span class="st">"G3"</span>, <span class="st">"G4"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Stub limma "top tables" with minimal required fields</span></span></span>
<span class="r-in"><span><span class="co"># (feature_nr + adj.P.Val)</span></span></span>
<span class="r-in"><span><span class="va">tt_wt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>feature_nr <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, adj.P.Val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.20</span>, <span class="fl">0.04</span>, <span class="fl">0.60</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tt_ko</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>feature_nr <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, adj.P.Val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.50</span>, <span class="fl">0.03</span>, <span class="fl">0.70</span>, <span class="fl">0.02</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tt_c2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>feature_nr <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, adj.P.Val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.04</span>, <span class="fl">0.70</span>, <span class="fl">0.80</span>, <span class="fl">0.90</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tt_c3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>feature_nr <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, adj.P.Val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.20</span>, <span class="fl">0.90</span>, <span class="fl">0.03</span>, <span class="fl">0.80</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">design_str</span> <span class="op">&lt;-</span> <span class="st">"~ 1 + Time*condition"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Minimal spline parameters required by spline machinery</span></span></span>
<span class="r-in"><span><span class="va">spline_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    spline_type <span class="op">=</span> <span class="st">"n"</span>, <span class="co"># natural cubic splines</span></span></span>
<span class="r-in"><span>    dof <span class="op">=</span> <span class="fl">1L</span> <span class="co"># degrees of freedom for the spline basis</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">toy_splineomics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    data <span class="op">=</span> <span class="va">toy_data</span>,</span></span>
<span class="r-in"><span>    meta <span class="op">=</span> <span class="va">toy_meta</span>,</span></span>
<span class="r-in"><span>    annotation <span class="op">=</span> <span class="va">toy_annot</span>,</span></span>
<span class="r-in"><span>    report_info <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        omics_data_type <span class="op">=</span> <span class="st">"RNA-seq"</span>,</span></span>
<span class="r-in"><span>        data_description <span class="op">=</span> <span class="st">"toy example"</span>,</span></span>
<span class="r-in"><span>        data_collection_date <span class="op">=</span> <span class="st">"2025-01-01"</span>,</span></span>
<span class="r-in"><span>        analyst_name <span class="op">=</span> <span class="st">"Example"</span>,</span></span>
<span class="r-in"><span>        contact_info <span class="op">=</span> <span class="st">"example@example.org"</span>,</span></span>
<span class="r-in"><span>        project_name <span class="op">=</span> <span class="st">"ToyProject"</span></span></span>
<span class="r-in"><span>    <span class="op">)</span>,</span></span>
<span class="r-in"><span>    design <span class="op">=</span> <span class="va">design_str</span>,</span></span>
<span class="r-in"><span>    mode <span class="op">=</span> <span class="st">"integrated"</span>,</span></span>
<span class="r-in"><span>    condition <span class="op">=</span> <span class="st">"condition"</span>,</span></span>
<span class="r-in"><span>    spline_params <span class="op">=</span> <span class="va">spline_params</span>,</span></span>
<span class="r-in"><span>    meta_batch_column <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>    meta_batch2_column <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>    limma_splines_result <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        time_effect                  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>WT <span class="op">=</span> <span class="va">tt_wt</span>, KO <span class="op">=</span> <span class="va">tt_ko</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        avrg_diff_conditions         <span class="op">=</span> <span class="va">tt_c2</span>,</span></span>
<span class="r-in"><span>        interaction_condition_time   <span class="op">=</span> <span class="va">tt_c3</span></span></span>
<span class="r-in"><span>    <span class="op">)</span>,</span></span>
<span class="r-in"><span>    feature_name_columns <span class="op">=</span> <span class="st">"gene"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">toy_splineomics</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"SplineOmics"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">toy_splineomics</span> <span class="op">&lt;-</span> <span class="fu"><a href="run_limma_splines.html">run_limma_splines</a></span><span class="op">(</span><span class="va">toy_splineomics</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Ensure the design has no Condition*Time interaction for mode == 'isolated', and includes it for mode == 'integrated'.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Running Levene's test both feature wise and sample wise to implicitly decide whether to use the limma array weights or not.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> No random effects: fitting model with lmFit()...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Running feature wise Levene's test...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ------------------------------------------------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Fraction of features violating homoscedasticity</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (p &lt; 0.050): 0.00% (0/8 features)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> No violating features found.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ------------------------------------------------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Running Levene's test across samples to detect inter-sample variance differences...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Levene's test p-value (sample-level): 0.1425</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ✅ No strong evidence of inter-sample variance differences.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ------------------------------------------------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ✅ No strong evidence for heteroscedasticity.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Proceeding WITHOUT using robust strategy.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ------------------------------------------------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Fitting global model...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">Info</span> Finished limma spline analysis in 0.0 min</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Clustering configuration: fixed k per condition</span></span></span>
<span class="r-in"><span><span class="va">nr_k</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>WT <span class="op">=</span> <span class="fl">2L</span>, KO <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Keep outputs light and write into a temporary directory</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">cluster_hits</span><span class="op">(</span></span></span>
<span class="r-in"><span>    splineomics <span class="op">=</span> <span class="va">toy_splineomics</span>,</span></span>
<span class="r-in"><span>    nr_clusters <span class="op">=</span> <span class="va">nr_k</span>,</span></span>
<span class="r-in"><span>    adj_pthresh_time_effect <span class="op">=</span> <span class="fl">0.05</span>,</span></span>
<span class="r-in"><span>    adj_pthresh_avrg_diff_conditions <span class="op">=</span> <span class="fl">0.05</span>,</span></span>
<span class="r-in"><span>    adj_pthresh_interaction_condition_time <span class="op">=</span> <span class="fl">0.05</span>,</span></span>
<span class="r-in"><span>    min_effect_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        time_effect <span class="op">=</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>        avg_diff_cond <span class="op">=</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>        interaction_cond_time <span class="op">=</span> <span class="fl">0</span></span></span>
<span class="r-in"><span>    <span class="op">)</span>,</span></span>
<span class="r-in"><span>    genes <span class="op">=</span> <span class="va">toy_annot</span><span class="op">$</span><span class="va">gene</span>,</span></span>
<span class="r-in"><span>    plot_info <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y_axis_label <span class="op">=</span> <span class="st">"log2 expression"</span>, time_unit <span class="op">=</span> <span class="st">"h"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    plot_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        cluster_heatmap_columns <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>        meta_replicate_column <span class="op">=</span> <span class="st">"Replicate"</span></span></span>
<span class="r-in"><span>    <span class="op">)</span>,</span></span>
<span class="r-in"><span>    raw_data <span class="op">=</span> <span class="va">toy_data</span>,</span></span>
<span class="r-in"><span>    report_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    max_hit_number <span class="op">=</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Ensure the design has no Condition*Time interaction for mode == 'isolated', and includes it for mode == 'integrated'.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  Performing the clustering...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> For the level:  KO</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> For the level:  WT</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Generating heatmap...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Generating cluster mean splines for level:  KO</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Generating spline plots...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Generating cluster mean splines for level:  WT</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Generating spline plots...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Generating report. This takes a few seconds.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  <span style="color: #00BB00;">Info</span> Clustering the hits completed successfully.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  Your HTML reports are located in the directory:  /tmp/RtmpdPGQHX .</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  Please note that due to embedded files, the reports might be flagged as</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  harmful by other software. Rest assured that they provide no harm.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Running this function took 0.1 min</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Rauter.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

