<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>cluster_hits() — cluster_hits • SplineOmics</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="cluster_hits() — cluster_hits"><meta name="description" content="Performs clustering on hits from top tables generated by differential
expression analysis.
This function filters hits based on adjusted p-value thresholds, extracts
spline coefficients for
significant features, normalizes these coefficients, and applies hierarchical
clustering. The results,
including clustering assignments and normalized spline curves, are saved in a
specified directory and
compiled into an HTML report."><meta property="og:description" content="Performs clustering on hits from top tables generated by differential
expression analysis.
This function filters hits based on adjusted p-value thresholds, extracts
spline coefficients for
significant features, normalizes these coefficients, and applies hierarchical
clustering. The results,
including clustering assignments and normalized spline curves, are saved in a
specified directory and
compiled into an HTML report."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SplineOmics</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/CHANGELOG.html">Changelog</a></li>
    <li><a class="dropdown-item" href="../articles/design_limma_design_formula.html">Designing a Limma Design Formula</a></li>
    <li><a class="dropdown-item" href="../articles/Docker_permission_denied.html">Docker_permission_denied</a></li>
    <li><a class="dropdown-item" href="../articles/Docker-instructions.html">Docker-instructions</a></li>
    <li><a class="dropdown-item" href="../articles/get-started.html">get-started</a></li>
    <li><a class="dropdown-item" href="../articles/glycan-analysis.html">Glycan-analysis</a></li>
    <li><a class="dropdown-item" href="../articles/limma_result_categories.html">limma_result_categories</a></li>
    <li><a class="dropdown-item" href="../articles/methylation_data_analysis.html">methylation-data-analysis</a></li>
    <li><a class="dropdown-item" href="../articles/PVC_analysis.html">PVC_analysis</a></li>
    <li><a class="dropdown-item" href="../articles/RNA-seq-analysis.html">RNA-seq-analysis</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../articles/CHANGELOG.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/csbg/SplineOmics/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>cluster_hits()</h1>
      <small class="dont-index">Source: <a href="https://github.com/csbg/SplineOmics/blob/HEAD/R/cluster_hits.R" class="external-link"><code>R/cluster_hits.R</code></a></small>
      <div class="d-none name"><code>cluster_hits.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Performs clustering on hits from top tables generated by differential
expression analysis.
This function filters hits based on adjusted p-value thresholds, extracts
spline coefficients for
significant features, normalizes these coefficients, and applies hierarchical
clustering. The results,
including clustering assignments and normalized spline curves, are saved in a
specified directory and
compiled into an HTML report.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">cluster_hits</span><span class="op">(</span></span>
<span>  <span class="va">splineomics</span>,</span>
<span>  <span class="va">nr_clusters</span>,</span>
<span>  adj_pthresholds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  adj_pthresh_avrg_diff_conditions <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  adj_pthresh_interaction_condition_time <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  min_effect_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>time_effect <span class="op">=</span> <span class="fl">0</span>, avg_diff_cond <span class="op">=</span> <span class="fl">0</span>, interaction_cond_time <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>  genes <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  plot_info <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y_axis_label <span class="op">=</span> <span class="st">"Value"</span>, time_unit <span class="op">=</span> <span class="st">"min"</span>, treatment_labels <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>    treatment_timepoints <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>  plot_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cluster_heatmap_columns <span class="op">=</span> <span class="cn">FALSE</span>, meta_replicate_column <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>,</span>
<span>  raw_data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  report_dir <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  report <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  max_hit_number <span class="op">=</span> <span class="fl">25</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-splineomics">splineomics<a class="anchor" aria-label="anchor" href="#arg-splineomics"></a></dt>
<dd><p>An S3 object of class `SplineOmics` that contains all the
necessary data and parameters for the analysis, including:</p><ul><li><p><code>data</code>: The data matrix with the values. The columns are the
  samples (timepoint + replicate combo) and the rows are the features
  (e.g. genes or proteins).</p></li>
<li><p><code>meta</code>: A dataframe containing metadata corresponding to the
  <code>data</code>, must include a 'Time' column and any columns specified by
  <code>conditions</code>. In general, the columns of meta correspond to the
  different types of metadata, and each row corresponds to a column of data
  (contains the metadata for that sample).</p></li>
<li><p><code>annotation</code>: A dataframe that maps the rows of <code>data</code> to
  annotation info, such as the gene name or database identifiers.</p></li>
<li><p><code>report_info</code>: A named list describing the experiment.
  Must include the following fields:
    - <code>"omics_data_type"</code>
    - <code>"data_description"</code>
    - <code>"data_collection_date"</code>
    - <code>"analyst_name"</code>
    - <code>"contact_info"</code>
    - <code>"project_name"</code></p>
<p>May also include the following optional fields:
    - <code>"method_description"</code>
    - <code>"results_summary"</code>
    - <code>"conclusions"</code></p></li>
<li><p><code>design</code>: A character of length 1 representing the limma
  design formula.</p></li>
<li><p><code>mode</code>: Specifies how the design formula is constructed:
  either `"isolated"` or `"integrated"`.</p>
<p>- `"isolated"`: Each level is analyzed independently, using only the
    subset of data corresponding to that level. The design formula does
    not include the condition variable, since only one condition is
    present in each subset.</p>
<p>- `"integrated"`: All levels are analyzed together in a single model,
    using the full dataset. The design formula includes the condition
    variable (and optionally interaction terms with it) so that results
    are estimated jointly across all levels.</p></li>
<li><p><code>condition</code>: Character vector of length 1 specifying the column
  name in <code>meta</code> used to define groups for analysis.</p></li>
<li><p><code>spline_params</code>: A list of spline parameters for the analysis.</p></li>
<li><p><code>meta_batch_column</code>: A character string specifying the column
  name in the metadata used for batch effect removal.</p></li>
<li><p><code>meta_batch2_column</code>: A character string specifying the second
  column name in the metadata used for batch effect removal.</p></li>
<li><p><code>limma_splines_result</code>: A list of data frames, each representing
   a top table from differential expression analysis, containing at least
   'adj.P.Val' and expression data columns.</p></li>
<li><p><code>feature_name_columns</code>: Character vector of strings that each
  specify a column of the original data dataframe which were used to
  automatically build the feature names with the <code>extract_data</code>
  function.</p></li>
</ul></dd>


<dt id="arg-nr-clusters">nr_clusters<a class="anchor" aria-label="anchor" href="#arg-nr-clusters"></a></dt>
<dd><p>Named list specifying the number of clusters per
  condition level. The list <strong>must</strong> have one element per condition
  level, and each element <strong>must be named exactly</strong> with the
  corresponding condition name (e.g., <code>"condition1"</code>,
  <code>"condition2"</code>).</p>
<p>Each element's value controls the <code>k</code> used by k-means for that level:</p>
<p>- <strong>Single integer</strong> (<code>k &gt; 0</code>, e.g. <code>3</code>): use exactly that
    many clusters.
  - <strong>Integer range</strong> (written with <code>:</code>, e.g. <code>2:6</code>):
    choose the <code>k</code> within the range that <strong>minimizes the
    Bayesian Information Criterion (BIC)</strong> computed from the k-means fit
    over that range (lower is better). Ties are broken by the first
    minimum encountered.</p>
<p><strong>Notes</strong></p><ul><li><p>All condition levels must be present exactly once as names.</p></li>
<li><p>Values must be positive integers; ranges must be increasing
          (e.g. <code>2:6</code>).</p></li>
<li><p>BIC is computed from k-means using Euclidean distance. A common
          form is \(\mathrm{BIC} = n \log(\mathrm{WCSS}/n) +
          k \log(n)\, p\), where \(n\) is the number of series, \(p\)
          the number of timepoints (features), and \(\mathrm{WCSS}\) the
          total within-cluster sum of squares for the fit.</p></li>
<li><p>Clustering will fail if the requested <code>k</code> is not strictly
          less than the number of available series for that level.</p></li>
</ul><p><strong>Example</strong>
  # Fixed k for condition1, BIC-selected k for condition2
  nr_clusters &lt;- list(
    condition1 = 4,
    condition2 = 2:6
  )</p></dd>


<dt id="arg-adj-pthresholds">adj_pthresholds<a class="anchor" aria-label="anchor" href="#arg-adj-pthresholds"></a></dt>
<dd><p>Numeric vector of p-value thresholds for filtering
hits in each top table. The order of the elements determines which
adj.p-value threshold is assigned to which condition (the first element
gets assigned to the first condition, the second to the second, etc.).</p></dd>


<dt id="arg-adj-pthresh-avrg-diff-conditions">adj_pthresh_avrg_diff_conditions<a class="anchor" aria-label="anchor" href="#arg-adj-pthresh-avrg-diff-conditions"></a></dt>
<dd><p>p-value threshold for the results
from the average difference of the condition limma result.</p></dd>


<dt id="arg-adj-pthresh-interaction-condition-time">adj_pthresh_interaction_condition_time<a class="anchor" aria-label="anchor" href="#arg-adj-pthresh-interaction-condition-time"></a></dt>
<dd><p>p-value threshold for the
results from the interaction of condition and time limma result.</p></dd>


<dt id="arg-min-effect-size">min_effect_size<a class="anchor" aria-label="anchor" href="#arg-min-effect-size"></a></dt>
<dd><p>A named list that specifies the minimum effect size
  thresholds to consider a feature as biologically meaningful, in addition
  to statistical significance. This allows users to filter out "trivial"
  hits that pass adjusted p-value cutoffs but show negligible effect sizes.</p>
<p>The list must contain the following elements:
  - `time_effect`: Minimum cumulative travel for time effects (Category 1).
    Features with a smaller travel will be ignored even if significant.
  - `avg_diff_cond`: Minimum absolute effect size for average differences
    between conditions (Category 2). Ensures that only contrasts with a
    relevant magnitude are reported.
  - `interaction_cond_time`: Minimum effect size for the interaction
    between condition and time (Category 3). This controls how large the
    differential curve travel must be across conditions to count as a hit.</p>
<p>Values should be numeric scalars (typically &gt;0). For example:
  `min_effect_size = list(time_effect = 1, avg_diff_cond = 1,
  interaction_cond_time = 2)` will only keep features with cumulative
  travels or condition-time differences above those cutoffs. Use smaller
  values (e.g., 0.1) for permissive filtering, or larger values for more
  conservative thresholds.</p>
<p>The default is 0 for all three elements.</p></dd>


<dt id="arg-genes">genes<a class="anchor" aria-label="anchor" href="#arg-genes"></a></dt>
<dd><p>A character vector of gene names corresponding to the features
to be analyzed. The order of entries must match the feature order in
<code>data</code>.
Gene names should be standardized (cleaned) to ensure compatibility with
downstream databases used for overrepresentation analysis after clustering.</p></dd>


<dt id="arg-plot-info">plot_info<a class="anchor" aria-label="anchor" href="#arg-plot-info"></a></dt>
<dd><p>List containing the elements y_axis_label (string),
time_unit (string), treatment_labels (character vector),
treatment_timepoints (integer vector). All can also be NA.
This list is used to add this info to the spline plots.
time_unit is used to label the x-axis, and treatment_labels
and -timepoints are used to create vertical dashed lines,
indicating the positions of the treatments (such as
feeding, temperature shift, etc.).</p></dd>


<dt id="arg-plot-options">plot_options<a class="anchor" aria-label="anchor" href="#arg-plot-options"></a></dt>
<dd><p>A named list controlling optional plot customization.
The list can include one or both of the following entries (any not supplied
will fall back to their default values):</p><ul><li><p><code>cluster_heatmap_columns</code> (`logical`, default = <code>FALSE</code>):
    Whether to cluster the columns in the heatmap.</p></li>
<li><p><code>meta_replicate_column</code> (`character(1)`,
    default = <code>NULL</code>):
    Name of the column in <code>meta</code> that encodes replicate information.
    If supplied, spline plot data points are colored by replicate, allowing
    replicate-level variation to be assessed.</p></li>
</ul></dd>


<dt id="arg-raw-data">raw_data<a class="anchor" aria-label="anchor" href="#arg-raw-data"></a></dt>
<dd><p>Data matrix with the raw (unimputed) data, still
containing NA values. When provided, it highlights the datapoints in the
spline plots that originally where NA and that were imputed.</p></dd>


<dt id="arg-report-dir">report_dir<a class="anchor" aria-label="anchor" href="#arg-report-dir"></a></dt>
<dd><p>Character string specifying the directory path where the
HTML report and any other output files should be saved. Default is the
current working dir.</p></dd>


<dt id="arg-report">report<a class="anchor" aria-label="anchor" href="#arg-report"></a></dt>
<dd><p>Boolean TRUE or FALSE value specifying if a report should be
generated.</p></dd>


<dt id="arg-max-hit-number">max_hit_number<a class="anchor" aria-label="anchor" href="#arg-max-hit-number"></a></dt>
<dd><p>Maximum number of hits which are plotted within each
cluster. This can be used to limit the computation time and size of
the HTML report in the case of many hits.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A named list with three elements:</p><dl><dt><code>cluster_table</code></dt>
<dd><p>A tibble containing one row per <code>feature_nr</code> with metadata and
    cluster assignments across the analysis categories. The structure is:</p><ul><li><p><code>feature_nr</code> - Numeric feature identifier.</p></li>
<li><p><code>feature_name</code> - Preferred feature name, prioritizing
        values from the limma tables, then from the cluster table row
        names, and falling back to the numeric feature ID.</p></li>
<li><p><code>gene</code> - Preferred gene symbol from the <code>annotation</code>
        table if available, otherwise taken from the cluster tables.</p></li>
<li><p><code>cluster_&lt;cond1&gt;</code> / <code>cluster_&lt;cond2&gt;</code> - Cluster
        assignments for each time-effect condition, named according to
        the elements of <code>clustered_hits_levels</code>.</p></li>
<li><p><code>cluster_cat2</code> - Present only if category 2 results are
        available; a combined cluster label in the form
        <code>"&lt;cluster_&lt;cond1&gt;&gt;_&lt;cluster_&lt;cond2&gt;&gt;"</code> for features that
        are significant in category 2. If this value is <code>NA</code>, the
        feature was not a category 2 hit.</p></li>
<li><p><code>cluster_cat3</code> - Present only if category 3 results are
        available; a combined cluster label in the form
        <code>"&lt;cluster_&lt;cond1&gt;&gt;_&lt;cluster_&lt;cond2&gt;&gt;"</code> for features that
        are significant in category 3. If this value is <code>NA</code>, the
        feature was not a category 3 hit.</p></li>
</ul><p>For any category-specific cluster column (<code>cluster_&lt;cond1&gt;</code>,
    <code>cluster_&lt;cond2&gt;</code>, <code>cluster_cat2</code>, <code>cluster_cat3</code>),
    a value of <code>NA</code> indicates that the feature was not significant
    (not a hit) in that category.</p></dd>

  <dt><code>spline_results</code></dt>
<dd><p>A named list summarizing the fitted spline trajectories, their shared
    time grid, and effect-size based significance flags. Structure:</p><dl><dt><code>time_grid</code></dt>
<dd><p>Numeric vector of length \(T\) giving the
        common time points (e.g., hours since cultivation start) on which
        all splines were predicted.</p></dd>

      <dt><code>predictions</code></dt>
<dd><p>Named list by condition (e.g.,
        <code>constant</code>, <code>temp_shift</code>). Each entry is a numeric
        matrix of size \(N \times T\) with rows corresponding to features
        and columns to <code>time_grid</code>. Values are the predicted spline
        trajectories on the absolute scale used in the analysis
        (e.g., log2-CPM after <code>voom</code>). Row order matches the feature
        order used throughout the analysis.</p></dd>

      <dt><code>time_effect_effect_size</code></dt>
<dd><p>Named list by condition with a
        numeric vector (length \(N\)) per condition giving the
        <em>cumulative travel</em> (integrated temporal change) of each
        feature`s spline across <code>time_grid</code>. Larger values indicate
        stronger within-condition temporal modulation.</p></dd>

      <dt><code>time_effect_passed_threshold</code></dt>
<dd><p>Named list by condition
        with a logical vector (length \(N\)) per condition indicating
        whether the corresponding <code>time_effect_effect_size</code> exceeds
        the user-defined effect-size threshold (i.e., time-effect hits).</p></dd>

      <dt><code>interaction_effect_size</code></dt>
<dd><p>Numeric vector (length \(N\))
        giving the <em>differential cumulative travel</em> between the two
        condition-specific splines of each feature, computed on the same
        <code>time_grid</code>. Larger values indicate stronger differences in
        temporal behaviour between conditions (condition-time interaction).</p></dd>

      <dt><code>interaction_passed_threshold</code></dt>
<dd><p>Logical vector (length
        \(N\)) indicating whether <code>interaction_effect_size</code>
        exceeds the interaction effect-size threshold (i.e., features with
        significantly different temporal profiles across conditions).</p></dd>


</dl><p>Unless stated otherwise, vectors are aligned to the same feature order
    used in the prediction matrices; condition names match
    <code>levels(meta[[condition]])</code>.</p></dd>

  <dt><code>plots</code></dt>
<dd><p>A list of all plots generated during the run, corresponding to the
    visualizations shown in the HTML report produced by this function.
    Additionally, this plots list also contains the plots showing the
    consensus clusters of the potential clustering of the interaction of
    condition and time (category 3) hits.</p></dd>


</dl></div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Rauter.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

