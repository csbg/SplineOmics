<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>preprocess_rna_seq_data() — preprocess_rna_seq_data • SplineOmics</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="preprocess_rna_seq_data() — preprocess_rna_seq_data"><meta name="description" content="The preprocess_rna_seq_data() function performs essential preprocessing
steps for raw RNA-seq counts. This includes creating a DGEList object,
normalizing the counts using the default TMM (Trimmed Mean of M-values)
normalization via the edgeR::calcNormFactors function, and applying the
voom transformation from the limma package to obtain log-transformed
counts per million (logCPM) with associated precision weights. If you
require a different normalization method, you can supply your own
custom normalization function."><meta property="og:description" content="The preprocess_rna_seq_data() function performs essential preprocessing
steps for raw RNA-seq counts. This includes creating a DGEList object,
normalizing the counts using the default TMM (Trimmed Mean of M-values)
normalization via the edgeR::calcNormFactors function, and applying the
voom transformation from the limma package to obtain log-transformed
counts per million (logCPM) with associated precision weights. If you
require a different normalization method, you can supply your own
custom normalization function."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SplineOmics</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/CHANGELOG.html">Changelog</a></li>
    <li><a class="dropdown-item" href="../articles/design_limma_design_formula.html">Designing a Limma Design Formula</a></li>
    <li><a class="dropdown-item" href="../articles/Docker_permission_denied.html">Docker_permission_denied</a></li>
    <li><a class="dropdown-item" href="../articles/Docker-instructions.html">Docker-instructions</a></li>
    <li><a class="dropdown-item" href="../articles/get-started.html">get-started</a></li>
    <li><a class="dropdown-item" href="../articles/glycan-analysis.html">Glycan-analysis</a></li>
    <li><a class="dropdown-item" href="../articles/limma_result_categories.html">limma_result_categories</a></li>
    <li><a class="dropdown-item" href="../articles/methylation_data_analysis.html">methylation-data-analysis</a></li>
    <li><a class="dropdown-item" href="../articles/PVC_analysis.html">PVC_analysis</a></li>
    <li><a class="dropdown-item" href="../articles/RNA-seq-analysis.html">RNA-seq-analysis</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../articles/CHANGELOG.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/csbg/SplineOmics/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>preprocess_rna_seq_data()</h1>
      <small class="dont-index">Source: <a href="https://github.com/csbg/SplineOmics/blob/HEAD/R/preprocess_rna_seq_data.R" class="external-link"><code>R/preprocess_rna_seq_data.R</code></a></small>
      <div class="d-none name"><code>preprocess_rna_seq_data.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The <code>preprocess_rna_seq_data()</code> function performs essential preprocessing
steps for raw RNA-seq counts. This includes creating a <code>DGEList</code> object,
normalizing the counts using the default TMM (Trimmed Mean of M-values)
normalization via the <code><a href="https://rdrr.io/pkg/edgeR/man/calcNormFactors.html" class="external-link">edgeR::calcNormFactors</a></code> function, and applying the
<code>voom</code> transformation from the <code>limma</code> package to obtain log-transformed
counts per million (logCPM) with associated precision weights. If you
require a different normalization method, you can supply your own
custom normalization function.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">preprocess_rna_seq_data</span><span class="op">(</span><span class="va">splineomics</span>, normalize_func <span class="op">=</span> <span class="cn">NULL</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-splineomics">splineomics<a class="anchor" aria-label="anchor" href="#arg-splineomics"></a></dt>
<dd><p>An S3 object of class <code>SplineOmics</code> that must contain the
following elements:</p><ul><li><p><code>data</code>: A matrix of the omics dataset, with feature names
optionally as row headers (genes as rows, samples as columns).</p></li>
<li><p><code>meta</code>: A dataframe containing metadata corresponding to the
<code>data</code>. The dataframe must include a 'Time' column and a column
specified by the <code>condition</code>.</p></li>
<li><p><code>design</code>: A character string representing the design formula
for the limma analysis (e.g., <code>'~ 1 + Phase*X + Reactor'</code>).</p></li>
<li><p><code>spline_params</code>: A list of spline parameters used in the
analysis. This can include:</p><ul><li><p><code>spline_type</code>: A character string specifying the type of
spline. Must be either <code>'n'</code> for natural cubic splines or
<code>'b'</code> for B-splines.</p></li>
<li><p><code>dof</code>: An integer specifying the degrees of freedom.
Required for both natural cubic splines and B-splines.</p></li>
<li><p><code>degree</code>: An integer specifying the degree of the spline
(for B-splines only).</p></li>
<li><p><code>knots</code>: Positions of the internal knots (for B-splines).</p></li>
<li><p><code>bknots</code>: Boundary knots (for B-splines).</p></li>
</ul></li>
<li><p><code>use_array_weights</code>: Boolean flag indicating if the robust fit
strategy to deal with heteroscedasticity should be used or not. If set to
NULL, then this is handeled implicitly based on the result of the Levene
test. If this test is significant for at least 10% of the features,
then the robust strategy is used. The robust strategy uses the function
voomWithQualityWeights for RNA-seq data instead of the normal voom
function. For other, non-count-based data, the function
limma::arrayWeights is used instead, combined with setting the robust
argument to TRUE for the limma::eBayes function. In summary, the strategy
employed by those functions is to downweights samples with higher
variance. This can be neccessary, because linear models have the
assumption of homoscedasticity, which means that the variance is
(approx.) the same across all datapoints where the linear model is fitted.
If this is violated, then the resulting p-values cannot be trusted
(common statistical wisdom).</p></li>
<li><p><code>bp_cfg</code>: A named numeric vector specifying the parallelization
configuration, with expected names <code>"n_cores"</code> and <code>"blas_threads"</code>.</p>
<p>This controls how many <strong>R worker processes</strong> (<code>n_cores</code>) and how many
<strong>BLAS/OpenBLAS threads per process</strong> (<code>blas_threads</code>) should be used
during parallel computation.</p>
<p>If <code>bp_cfg</code> is <code>NULL</code>, missing, or any of its required fields is
<code>NA</code>, both <code>n_cores</code> and <code>blas_threads</code> default to <code>1</code>. This effectively
disables parallelization and avoids oversubscription of CPU threads.</p></li>
</ul></dd>


<dt id="arg-normalize-func">normalize_func<a class="anchor" aria-label="anchor" href="#arg-normalize-func"></a></dt>
<dd><p>An optional normalization function. If provided, this
function will be used to normalize the <code>DGEList</code> object. If not provided,
TMM normalization (via <code><a href="https://rdrr.io/pkg/edgeR/man/calcNormFactors.html" class="external-link">edgeR::calcNormFactors</a></code>) will be used by default.
Must take as
input the y of: y &lt;- edgeR::DGEList(counts = raw_counts) and output the y
with the normalized counts.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Boolean flag controlling the display of messages.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The updaed <code>splineomics</code> object, now containing the <code>voom</code> object,
which includes the log2-counts per million (logCPM) matrix and
observation-specific weights. Additionally, the splineparams are updated with
the identified optimal dof based on LOOCV, when dof = 0L (for auto-dof)</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>edgeR::DGEList, edgeR::calcNormFactors</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"edgeR"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">&amp;&amp;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"limma"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="co"># Toy raw counts: 4 genes x 6 samples (2 conditions x 3 timepoints)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">24</span>, lambda <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        nrow <span class="op">=</span> <span class="fl">4</span>, ncol <span class="op">=</span> <span class="fl">6</span>,</span></span>
<span class="r-in"><span>        dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"g"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"s"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        Time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WT"</span>, <span class="st">"KO"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        row.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># Simple fixed-effects design (no random effects → uses limma::voom)</span></span></span>
<span class="r-in"><span>    <span class="va">design_str</span> <span class="op">&lt;-</span> <span class="st">"~ 0 + Time + condition"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># Spline params: natural cubic with fixed dof (avoid auto-dof path)</span></span></span>
<span class="r-in"><span>    <span class="va">sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        spline_type <span class="op">=</span> <span class="st">"n"</span>, dof <span class="op">=</span> <span class="fl">3L</span>, degree <span class="op">=</span> <span class="cn">NA_integer_</span>,</span></span>
<span class="r-in"><span>        knots <span class="op">=</span> <span class="cn">NULL</span>, bknots <span class="op">=</span> <span class="cn">NULL</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># Build minimal SplineOmics object</span></span></span>
<span class="r-in"><span>    <span class="va">so</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        data <span class="op">=</span> <span class="va">counts</span>,</span></span>
<span class="r-in"><span>        meta <span class="op">=</span> <span class="va">meta</span>,</span></span>
<span class="r-in"><span>        design <span class="op">=</span> <span class="va">design_str</span>,</span></span>
<span class="r-in"><span>        condition <span class="op">=</span> <span class="st">"condition"</span>,</span></span>
<span class="r-in"><span>        spline_params <span class="op">=</span> <span class="va">sp</span>,</span></span>
<span class="r-in"><span>        use_array_weights <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># skip homoscedasticity auto-check</span></span></span>
<span class="r-in"><span>        bp_cfg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n_cores <span class="op">=</span> <span class="fl">1L</span>, blas_threads <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">so</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"SplineOmics"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># Run preprocessing (TMM + voom)</span></span></span>
<span class="r-in"><span>    <span class="va">so2</span> <span class="op">&lt;-</span> <span class="fu">preprocess_rna_seq_data</span><span class="op">(</span><span class="va">so</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># Inspect the voom results (logCPM matrix dimensions)</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">so2</span><span class="op">$</span><span class="va">rna_seq_data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>        <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">so2</span><span class="op">$</span><span class="va">rna_seq_data</span><span class="op">$</span><span class="va">E</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Preprocessing RNA-seq data (normalization + voom)...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients not estimable: X3 </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Partial NA coefficients for 4 probe(s)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">Info</span> Finished preprocessing RNA-seq</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>         data in 0.0 minutes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 4 6</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Rauter.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

